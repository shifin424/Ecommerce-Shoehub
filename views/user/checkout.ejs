<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>checkoutPage</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>


	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">

	<link rel="stylesheet" href="/css/open-iconic-bootstrap.min.css">
	<link rel="stylesheet" href="/css/animate.css">

	<link rel="stylesheet" href="/css/owl.carousel.min.css">
	<link rel="stylesheet" href="/css/owl.theme.default.min.css">
	<link rel="stylesheet" href="/css/magnific-popup.css">

	<link rel="stylesheet" href="/css/aos.css">

	<link rel="stylesheet" href="/css/ionicons.min.css">

	<link rel="stylesheet" href="/css/bootstrap-datepicker.css">
	<link rel="stylesheet" href="/css/jquery.timepicker.css">


	<link rel="stylesheet" href="/css/flaticon.css">
	<link rel="stylesheet" href="/css/icomoon.css">
	<link rel="stylesheet" href="/css/style.css">



</head>

<body class="goto-here ">


	<nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
		<div class="container">
			<a class="navbar-brand" href="/">SHOE HUB</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
				aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="oi oi-menu"></span> Menu
			</button>

			<div class="collapse navbar-collapse" id="ftco-nav">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item"><a href="/" class="nav-link">Home</a></li>
					<li class="nav-item dropdown active">
						<a class="nav-link dropdown-toggle" href="#" id="dropdown04" data-toggle="dropdown"
							aria-haspopup="true" aria-expanded="false">Catalog</a>
						<div class="dropdown-menu" aria-labelledby="dropdown04">
							<a class="dropdown-item" href="/shop">Shop</a>
							<a class="dropdown-item" href="/Viewcart">Cart</a>
							<a class="dropdown-item" href="/checkout">Checkout</a>
						</div>
					<li class="nav-item"><a href="/contact" class="nav-link">Contact</a></li>

					<li class="nav-item"><a href="/logout" class="nav-link">Logout</a></li>
					<li class="nav-item cta cta-colored">
						<a href="/Viewcart" class="nav-link"><span class="icon-shopping_cart"></span></a>
					</li>
					<li class="nav-item cta cta-colored">
						<a href="" class="nav-link"><span class=" icon-heart"></span></a>
					</li>
					<li class="nav-item cta cta-colored">
						<a href="/profile" class="nav-link"><span class="icon-user"></span></a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- END nav -->



	<!-- background image start -->

	<div class="hero-wrap hero-bread" style="background-image: url('images/bg_6.jpg');">
		<div class="container">
			<div class="row no-gutters slider-text align-items-center justify-content-center">
				<div class="col-md-9 ftco-animate text-center">
					<p class="breadcrumbs"><span class="mr-2"><a href="">Home</a></span> <span>Checkout</span></p>
					<h1 class="mb-0 bread">Checkout</h1>
				</div>
			</div>
		</div>
	</div>

	<!-- background imaage end -->


	<!-- Address Detils -->
	<section class="ftco-section">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-xl-10 ftco-animate">





					<!-- Address edit -->
					<section class="ftco-section">
						<form id="placeOrder">

							<div class="container-fluid">


								<div class="col-xl-10 ftco-animate fadeInUp ftco-animated">
									<div class="row justify-content-center">
										<div class="container pb-4">
											<button type="button" class="btn btn-primary" data-bs-toggle="modal"
												data-bs-target="#exampleModal">
												Add new address
											</button>
										</div>
										<h3 class="mb-4 billing-heading">Billing Details</h3>

										<div>
											<div class="form-group">
												<label for="country">Select Shipping Address
												</label>
												<div class="select-wrap">

													<select class="form-control form-select mt-2" style="color: #000;"
														onchange="updateAddressDetails(this.value)">
														<option
															style="font-weight: 100; color: rgb(92, 92, 92) !important;"
															value="2">Select Your Address</option>
														<% if (userData.addressDetails &&
															userData.addressDetails.length> 0)
															{ %>
															<% for (let i=0; i < userData.addressDetails.length; i++) {
																%>

																<option value="<%= userData.addressDetails[i]._id %>">
																	<%= userData.addressDetails[i].username %>
																		<%= userData.addressDetails[i].housename%>
																</option>

																<% } %>
																	<% } else { %>
																		<p>No address selected</p>
																		<% } %>
													</select>
												</div>
											</div>
										</div>
										<div class="row align-items-end">
											<div class="col-md-6">
												<div class="form-group">
													<label for="firstname">House Name</label>
													<input type="text" name="housename" id="housename"
														style="font-weight: bold; color: rgb(92, 92, 92) !important;"
														class="form-control" placeholder="" fdprocessedid="ib393" required>
												</div>
											</div>
											<div class="col-md-6">
												<div class="form-group">
													<label for="lastname">Area</label>
													<input type="text" id="area" name="area"
														style="font-weight: bold; color:rgb(92, 92, 92) !important;"
														class="form-control" placeholder="" fdprocessedid="4xtq1b" required>
												</div>
											</div>

											<div class="col-md-6">
												<div class="form-group">
													<label for="streetaddress">Land Mark</label>
													<input type="text" id="landmark" name="landMark"
														style="font-weight: bold; color: rgb(92, 92, 92) !important;"
														class="form-control" placeholder="" fdprocessedid="iwf96m" required>
												</div>
											</div>

											<div class="col-md-6">
												<div class="form-group">
													<label for="streetaddress">District</label>
													<input type="text" id="district" name="district"
														style="font-weight: bold; color: rgb(92, 92, 92) !important;"
														class="form-control" placeholder="" fdprocessedid="4xtq1b" required>
												</div>
											</div>

											<div class="w-100"></div>
											<div class="col-md-6">
												<div class="form-group">
													<label for="towncity">State</label>
													<input type="text" id="state" name="state"
														style="font-weight: bold; color: rgb(92, 92, 92) !important;"
														class="form-control" placeholder="" fdprocessedid="4iwr3" required>
												</div>
											</div>
											<div class="col-md-6">
												<div class="form-group">
													<label for="postcodezip">Post Office</label>
													<input type="text" id="postoffice" name="postOffice"
														style="font-weight: bold; color: rgb(92, 92, 92) !important;"
														class="form-control" placeholder="" fdprocessedid="y5r53" required>
												</div>
											</div>
											<div class="w-100"></div>
											<div class="col-md-6">
												<div class="form-group">
													<label for="phone">Pincode</label>
													<input type="number" id="pincode" name="pincode"
														style="font-weight: bold; color: rgb(92, 92, 92) !important;"
														class="form-control" placeholder="" fdprocessedid="w97al9" required>
												</div>
											</div>

											<div class="container d-flex ">

												<div class="form-group mt-5">
													<h6>Have coupon? Apply here!</h6>
													<div class="input-group"> <input type="text"
															class="form-control coupon" name="coupon"
															placeholder="Coupon code"> <span
															class="input-group-append"></span>
													</div>
												</div>

											</div>
										</div>

									</div>
								</div>
							</div>






							<div class="row mt-5 pb-5 d-flex">
								<div class="col-md-6 d-flex">
									<div class="cart-detail cart-total bg-light p-3 p-md-4">
										<h3 class="billing-heading mb-4">Amount to Paid</h3>
										<p class="d-flex ">
											<span>Product</span>
											<span>Total</span>
											<% productData.forEach(function(product) {%>

										</p>
										<p class="d-flex">
											<span>
												<%=product.productDetail.name%> <strong class="mx-2">x</strong>
													<%= product.productQuantity%>
											</span>
											<% var a=product.productDetail.price%>
												<% var b=product.productQuantity%>
													<% var c=a*b %>
														<td>
															<span>
																<%= c %>₹
															</span>
										</p>
										<% }) %>
											<hr>
											<p class="d-flex ">
												<span>Total Amount</span>
												<span>
													<%=sum%> ₹
												</span>
											</p>
									</div>
								</div>

								<div class="col-md-6">
									<div class="cart-detail bg-light p-3 p-md-4">
										<h3 class="billing-heading mb-4">Payment Method</h3>
										<div class="form-group">
											<div class="col-md-12">
												<div class="radio">
													<label><input type="radio" value="COD" name="paymentMethod"
															class="mr-2" checked required> COD (cash on
														delivery)</label>
												</div>
											</div>
										</div>
										<div class="form-group">
											<div class="col-md-12">
												<div class="radio">
													<label><input type="radio" value="Online" name="paymentMethod"
															class="mr-2" checked required>Online</label>
												</div>
											</div>
										</div>


										<button style="border: none;background: none;" type="submit" value="submit"><a
												style="width: 10rem;height: 2rem;color: #000;"
												class="buy-now btn btn-sm btn-primary ">Place an Order</a>
										</button>

									</div>
								</div>
							</div>
						</form>

					</section>
				</div>
			</div>
		</div>
	</section>



	<!-- Footer starts here -->

	<footer class="ftco-footer ftco-section">
		<div class="container">
			<div class="row">
				<div class="mouse">
					<a href="#" class="mouse-icon">
						<div class="mouse-wheel">
							<span class="ion-ios-arrow-up"></span>
						</div>
					</a>
				</div>
			</div>
			<div class="row mb-5">
				<div class="col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">SHOEHUB</h2>
						<p>
							"The right shoes can make everything different.”
						</p>
						<ul class="ftco-footer-social list-unstyled float-md-left float-lft mt-5">
							<li class="ftco-animate">
								<a href=""><span class="icon-instagram"></span></a>
							</li>
						</ul>
					</div>
				</div>
				<div class="col-md">
					<div class="ftco-footer-widget mb-4 ml-md-5">
						<h2 class="ftco-heading-2">Menu</h2>
						<ul class="list-unstyled">
							<li><a href="#" class="py-2 d-block">Home</a></li>
							<li><a href="#" class="py-2 d-block">Catalog</a></li>
							<li><a href="#" class="py-2 d-block">Contact Us</a></li>
							<li><a href="#" class="py-2 d-block">Profile</a></li>
						</ul>
					</div>
				</div>
				<div class="col-md-4">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">Help</h2>
						<div class="d-flex">
							<ul class="list-unstyled mr-l-5 pr-l-3 mr-4">
								<li>
									<a href="#" class="py-2 d-block">Shipping Information</a>
								</li>
								<li>
									<a href="#" class="py-2 d-block">Returns &amp; Exchange</a>
								</li>
								<li>
									<a href="#" class="py-2 d-block">Terms &amp; Conditions</a>
								</li>
								<li><a href="#" class="py-2 d-block">Privacy Policy</a></li>
							</ul>
						</div>
					</div>
				</div>
				<div class="col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">Have a Questions?</h2>
						<div class="block-23 mb-3">
							<ul>
								<li>
									<span class="icon icon-map-marker"></span><span class="text">HiLight business Park ,
										calicut ,kerala</span>
								</li>
								<li>
									<a href="#"><span class="icon icon-phone"></span><span
											class="text">6238424753</span></a>
								</li>
								<li>
									<a href="#"><span class="icon icon-envelope"></span><span
											class="text">shoehub2023@gmail.com</span></a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12 text-center">
					<p>

						Copyright &copy;
						<script>
							document.write(new Date().getFullYear());
						</script>
						All rights reserved | This template is made
						<i class="icon-heart color-danger" aria-hidden="true"></i> by
						<a href="https://colorlib.com" target="_blank">Shifin</a>

					</p>
				</div>
			</div>
		</div>
	</footer>

	<!-- loader -->
	<div id="ftco-loader" class="show fullscreen">
		<svg class="circular" width="48px" height="48px">
			<circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
			<circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
				stroke="#F96D00" />
		</svg>
	</div>

	<!-- Add address modal-->

	<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Add new Address</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form action="/addNewAddress" method="post">
						<div class="modal-body">
							<div class="mb-1">
								<label for="recipient-name" class="col-form-label">Housename:</label>
								<input required type="text" class="form-control" id="housename" name="housename" />
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">Area:</label>
								<input required type="text" class="form-control" id="area" name="area" />
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">Landmark:</label>
								<input required type="text" class="form-control" id="landmark" name="landmark" />
							</div>
							<div class="mb-3">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label for="firstName">District</label>
										<input required type="text" class="form-control" id="district"
											name="district" />
									</div>
									<div class="col-md-6 mb-3">
										<label for="lastName">State</label>
										<input required type="text" class="form-control" id="state" name="state" />

									</div>
								</div>
							</div>
							<div class="mb-3">
								<div class="row">
									<div class="col-md-6 mb-3">
										<label for="firstName">Post office</label>
										<input required type="text" class="form-control" id="postoffice"
											name="postoffice" />
									</div>
									<div class="col-md-6 mb-3">
										<label for="lastName">Pincode</label>
										<input required type="text" class="form-control" id="pin" name="pin" />

									</div>
								</div>
							</div>
						</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						Close
					</button>
					<button type="submit" value="submit" class="btn btn-primary">
						Add
					</button>
				</div>
			</div>
			</form>
		</div>
	</div>


	<!-- Add address End -->


	<script>
		async function updateAddressDetails(addressId) {
			const res = await fetch('/getAddressDetails/' + addressId)
			const data = await res.json();
			if (data.message === 'Address not found') {
				document.querySelector('#housename').value = "";
				document.querySelector('#area').value = "";
				document.querySelector('#landmark').value = "";
				document.querySelector('#district').value = "";
				document.querySelector('#state').value = "";
				document.querySelector('#postoffice').value = "";
				document.querySelector('#pincode').value = "";
			} else {
				document.querySelector('#housename').value = data.housename
				document.querySelector('#area').value = data.area
				document.querySelector('#landmark').value = data.landMark
				document.querySelector('#district').value = data.district
				document.querySelector('#state').value = data.postoffice
				document.querySelector('#postoffice').value = data.state
				document.querySelector('#pincode').value = data.pin;
			}
		}
	</script>



	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>


	<!-- bootsrap -->
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
		integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
		integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
	// <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
	// <script>
	// 	var myModalEl = document.getElementById('myModal')
	// 	myModalEl.addEventListener('hidden.bs.modal', function (event) {

	// 	})
	// </script>

	<script>
		$("#placeOrder").submit((e) => {
			console.log(1, "reached here");
			e.preventDefault();
			$.ajax({
				url: '/placeOrder',
				method: 'post',
				data: $('#placeOrder').serialize(),
				success: (response) => {
					console.log(2, "reached here");
					if (response.couponDeleted) {
						Swal.fire({
							title: "Coupon no longer exist!",
							icon: "error",
							confirmButtonText: "continue",
						}).then(function () {
							location.reload()
						});
					}
					else if (response.coupon) {
						console.log(3, "reached here");
						Swal.fire({
							title: "Coupon already used!",
							icon: "error",
							confirmButtonText: "continue",
						}).then(function () {
							location.reload()
						});
					}

					else if (response.invalid) {
						console.log(1, "reached here");
						Swal.fire({
							title: "Invalid Coupon!",
							icon: "error",
							confirmButtonText: "continue",
						}).then(function () {
							location.reload()
						});
					} else if (response.success) {
						location.href = "/orderSuccess";
					} else {

						razorPay(response.order);
					}
				}
			})
		})


		function razorPay(order) {
			console.log(order);
			var options = {
				"key": 'rzp_test_olbfPbHyDJjoSe',
				"amount": order.amount,
				"currency": "INR",
				"name": "Shoehub",
				"description": "Test Transaction",
				"image": "/images/logo.png",
				"order_id": order.id,
				"handler": function (response) {

					verifyPayment(response, order);
				},
				"prefill": {
					"name": "Shoehub",
					"email": "shoehub2023@gmail.com",
					"contact": "4444444444"
				},
				"notes": {
					"address": "Razorpay Corporate Office"
				},
				"theme": {
					"color": "#DBCC8F"
				}
			};
			var rzp1 = new Razorpay(options);
			rzp1.on('payment.failed', function (response) {

				location.href = "/paymentFail";
			});
			rzp1.open();
		}
		function verifyPayment(payment, order) {
			$.ajax({
				url: "/verifyPayment",
				data: {
					payment,
					order,
				},
				method: "post",
				success: (response) => {
					if (response.success) {
						location.href = "/orderSuccess";
					} else {
						location.href = "/paymentFail";
					}
				},
			});
		}




	</script>



	<script src="/js/jquery.min.js"></script>
	<script src="/js/jquery-migrate-3.0.1.min.js"></script>
	<script src="/js/popper.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/js/jquery.easing.1.3.js"></script>
	<script src="/js/jquery.waypoints.min.js"></script>
	<script src="/js/jquery.stellar.min.js"></script>
	<script src="/js/owl.carousel.min.js"></script>
	<script src="/js/jquery.magnific-popup.min.js"></script>
	<script src="/js/aos.js"></script>
	<script src="/js/jquery.animateNumber.min.js"></script>
	<script src="/js/bootstrap-datepicker.js"></script>
	<script src="/js/scrollax.min.js"></script>
	<script src="/js/google-map.js"></script>
	<script src="/js/main.js"></script>
	<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</body>

</html>